<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>直播间展示</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 max-w-screen-md">
        <h1 class="text-3xl font-bold text-center mb-6">当前点歌</h1>
        <div id="display-list" class="grid grid-cols-2 gap-4">
            {% for song in queue %}
            <div class="bg-white rounded-lg shadow-md p-4 flex">
                <img src="/cover/{{ song.id }}.png" alt="{{ song.name }}" class="w-24 h-24 object-cover rounded-md mr-4">
                <div class="flex-grow">
                    <h2 class="text-xl font-semibold break-words">{{ loop.index0 + 1 }}. {{ song.name }}</h2>
                    <p class="text-gray-600"> {{ song.artist | default('未知') }}</p>
                    <p class="text-gray-600"> {{ song.type }}</p>
                    <div class="flex mt-2">
                        {% if song.ds %}
                            {% for difficulty in song.ds %}
                                {% set bgColor = '' %}
                                {% if song.ds|length == 1 %}
                                    {% set bgColor = 'bg-pink-450' %}
                                {% elif song.ds|length == 2 %}
                                    {% set bgColor = 'bg-pink-450' %}
                                {% else %}
                                    {% if loop.index0 == 0 %}
                                        {% set bgColor = 'bg-green-500' %}
                                    {% elif loop.index0 == 1 %}
                                        {% set bgColor = 'bg-yellow-500' %}
                                    {% elif loop.index0 == 2 %}
                                        {% set bgColor = 'bg-red-500' %}
                                    {% elif loop.index0 == 3 %}
                                        {% set bgColor = 'bg-purple-500' %}
                                    {% elif loop.index0 == 4 %}
                                        {% set bgColor = 'bg-purple-100 text-gray-800' %}
                                    {% else %}
                                        {% set bgColor = 'bg-gray-300' %}
                                    {% endif %}
                                {% endif %}
                                <span class="{{ bgColor }} text-white text-xs font-bold px-2 py-1 rounded-full mr-1">{{ difficulty }}</span>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function fetchQueue() {
            fetch('/get_queue')
                .then(response => response.json())
                .then(queue => {
                    const displayList = document.getElementById('display-list');
                    displayList.innerHTML = ''; // Clear current list
                    queue.forEach((song, index) => {
                        const songCard = `
                            <div class="bg-white rounded-lg shadow-md p-4 flex">
                                <img src="/cover/${song.id}.png" alt="${song.name}" class="w-24 h-24 object-cover rounded-md mr-4">
                <div class="flex-grow">
                    <h2 class="text-xl font-semibold break-words">${index + 1}. ${song.name}</h2>
                    <p class="text-gray-600"> ${song.artist || '未知'}</p>
                    <p class="text-gray-600"> ${song.type === 'SD' ? '标准谱' : song.type === 'DX' ? 'DX谱' : ''}</p>
                    <div class="flex mt-2">
                        ${(song.ds || []).map((difficulty, index) => {
                                            let bgColor = '';
                                            if (song.ds && song.ds.length === 1) {
                                                bgColor = 'bg-pink-500';
                                            } else if (song.ds && song.ds.length === 2) {
                                                bgColor = 'bg-pink-500';
                                            } else {
                                                switch(index) {
                                                    case 0: bgColor = 'bg-green-500'; break;
                                                    case 1: bgColor = 'bg-yellow-500'; break;
                                                    case 2: bgColor = 'bg-red-500'; break;
                                                    case 3: bgColor = 'bg-purple-500'; break;
                                                    case 4: bgColor = 'bg-purple-200 text-gray-800'; break;
                                                    default: bgColor = 'bg-gray-300';
                                                }
                                            }
                                            return `<span class="${bgColor} text-white text-xs font-bold px-2 py-1 rounded-full mr-1">${difficulty}</span>`;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                        displayList.innerHTML += songCard;
                    });
                });
        }

        document.addEventListener('DOMContentLoaded', function() {
            fetchQueue(); // Fetch queue on initial load
            setInterval(fetchQueue, 5000); // Refresh every 5 seconds
        });
    </script>
</body>
</html>